<mat-stepper
  (selectionChange)='stepSelectionChange($event)'
  [orientation]="(stepperOrientation$ | async) ?? 'horizontal'"
>
  <mat-step *ngFor='let section of sections; trackBy: trackByFn'>
    <ng-template matStepLabel>{{ section.name }}</ng-template>

    <ng-template matStepContent>
      <ng-container *ngIf='section$ | async as current'>
        <ng-container
          *ngIf='current.id === section.id'>
          <formidable-form-builder
            (formSubmit)='submit($event)'
            [buttonTemplate]='buttons'
            [fields]='current.fields'
          >
            <ng-template #buttons>
              <div class='d-flex'>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext>Next</button>
              </div>
            </ng-template>
          </formidable-form-builder>
        </ng-container>
      </ng-container>

      <ng-container *ngIf='loading$ | async'>
        <div class='content-center'>
          <mat-spinner class='m-auto'></mat-spinner>
        </div>
      </ng-container>
    </ng-template>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>Done</ng-template>
    <ng-template matStepContent>
      <p>You are now done.</p>
      <button mat-button matStepperPrevious>Back</button>
    </ng-template>
  </mat-step>
</mat-stepper>
