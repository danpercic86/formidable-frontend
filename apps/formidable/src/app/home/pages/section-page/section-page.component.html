<mat-stepper
  (selectionChange)="step$.next($event.selectedIndex)"
  [orientation]="(stepperOrientation$ | async) ?? 'horizontal'"
>
  <mat-step *ngFor="let section of minimalSections$ | async; trackBy: trackByFn">
    <ng-template matStepLabel>{{ section.name }}</ng-template>

    <ng-template matStepContent>
      <ng-container *ngIf="section$ | async as current">
        <ng-container *ngIf="current.id === section.id">
          <formidable-form-builder
            #formBuilder
            (formSubmit)="submit($event, current.id)"
            [buttonTemplate]="buttons"
            [fields]="current.fields"
            [formControl]="formControl"
          >
            <ng-template #buttons>
              <div class="d-flex">
                <button mat-button matStepperPrevious>Back</button>
                <button
                  (click)="formBuilder.onSubmit($event)"
                  mat-button
                  matStepperNext
                >
                  Next
                </button>
              </div>
            </ng-template>
          </formidable-form-builder>
        </ng-container>
      </ng-container>

      <ng-container *ngIf="sectionsService.loading$ | async">
        <div class="content-center">
          <mat-spinner class="m-auto"></mat-spinner>
        </div>
      </ng-container>
    </ng-template>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>Done</ng-template>
    <ng-template matStepContent>
      <p>You are now done.</p>
      <button mat-button matStepperPrevious>Back</button>
    </ng-template>
  </mat-step>
</mat-stepper>
